<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è‹±èªæœ¬æ–‡ãƒ»é•ã„æ¢ã—ã‚²ãƒ¼ãƒ ï½œ2åˆ†ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
  <style>
    :root{
      --bg: linear-gradient(135deg,#ffecd2 0%, #fcb69f 100%);
      --card: #ffffffEE;
      --ink: #222;
      --accent: #ff4d6d;
      --accent-2:#845ef7;
      --good:#2f9e44;
      --bad:#e03131;
      --muted:#6b7280;
      --shadow: 0 10px 30px rgba(0,0,0,.12);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic","Noto Sans JP",sans-serif; color:var(--ink); background:var(--bg);
      display:flex; align-items:stretch; justify-content:center;
    }
    .wrap{width:min(1100px,96%); padding:18px 14px 28px;}
    header{ display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:12px; }
    .title{ display:flex; align-items:center; gap:10px; font-weight:800; font-size:clamp(18px,3.2vw,28px); }
    .title .logo{width:40px; height:40px; border-radius:12px; background: radial-gradient( circle at 30% 20%, #fff 0 30%, transparent 31%), linear-gradient(135deg,#ff5d8f,#845ef7); box-shadow: var(--shadow); position:relative}
    .title .logo:after{content:"ğŸ¯"; position:absolute; inset:0; display:grid; place-items:center; font-size:22px}

    .controls{display:flex; gap:10px; flex-wrap:wrap;}
    button{ border:none; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer; box-shadow: var(--shadow);
      background: linear-gradient(135deg,var(--accent),#ff9aa2); color:#fff; transition:.2s transform ease; }
    button.secondary{ background: linear-gradient(135deg,#6c757d,#99a2ad); }
    button.flat{ background:#fff; color:#333 }
    button:active{ transform: translateY(1px) }
    .pill{ padding:8px 12px; border-radius:999px; background:#fff; box-shadow: var(--shadow); font-weight:700 }

    .grid{ display:grid; grid-template-columns: 1fr; gap:14px; }

    .card{ background:var(--card); border-radius: var(--radius); box-shadow: var(--shadow); padding:16px 18px; }
    .card h2{ margin:4px 0 8px; font-size:18px }

    .muted{ color:var(--muted); }
    .big{ font-size:14px; line-height:1.9 }

    .word{ padding:1px 3px; border-radius:8px; transition: background .15s ease, transform .05s ease; cursor:pointer; display:inline-block }
    .word:hover{ background: rgba(255,77,109,.12) }
    .word.clicked{ outline: 2px dashed rgba(0,0,0,.12) }
    .word.correct{ background: rgba(47,158,68,.18) }
    .word.wrong{ background: rgba(224,49,49,.18) }

    .score{ color:var(--good); font-weight:800 }
    .score.neg{ color:var(--bad) }
    .time{ font-weight:800; color:var(--accent-2) }

    .toast{ position: fixed; left: 50%; top: 22px; transform: translateX(-50%); background:#fff; box-shadow: var(--shadow); padding:12px 14px; border-radius:12px; display:flex; gap:10px; align-items:flex-start; z-index: 30; max-width:min(620px,92%); }
    .toast.hidden{ display:none }
    .toast strong{ display:block }

    .modal{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:40; }
    .modal .scrim{ position:absolute; inset:0; background: rgba(0,0,0,.25); }
    .modal .panel{ position:relative; background:#fff; border-radius:18px; box-shadow: var(--shadow); width:min(800px,92%); max-height:80vh; overflow:auto; padding:18px; }
    .modal .panel h3{ margin:4px 0 12px; }
    .modal.show{ display:flex }
    .answers{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:13px; }

    .result{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50; }
    .result .scrim{ position:absolute; inset:0; background: rgba(0,0,0,.5); }
    .result .board{ position:relative; background:#fff; border-radius:22px; box-shadow: var(--shadow); width:min(720px,92%); padding:28px; text-align:center; }
    .result .scorebig{ font-size: clamp(48px, 8vw, 96px); font-weight: 900; color: var(--accent-2); margin: 8px 0 4px; }
    .result .sub{ color:#555; margin-bottom:10px }

    .footer{ text-align:center; margin-top:16px; color:#333; opacity:.9 }
    .badge{ display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#fff; margin-left:6px; box-shadow: var(--shadow) }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title"><div class="logo" aria-hidden="true"></div>è‹±èªæœ¬æ–‡ãƒ»é•ã„æ¢ã—ã‚²ãƒ¼ãƒ  <span class="badge">2åˆ†ãƒãƒ£ãƒ¬ãƒ³ã‚¸</span></div>
      <div class="controls">
        <button id="startBtn" aria-label="ã‚²ãƒ¼ãƒ é–‹å§‹">â–¶ï¸ ã‚¹ã‚¿ãƒ¼ãƒˆï¼ãƒªã‚»ãƒƒãƒˆ</button>
        <button id="newSetBtn" class="flat" aria-label="ä½œã‚Šç›´ã—">ğŸ” ä½œã‚Šç›´ã—</button>
        <button id="hintBtn" class="secondary" aria-label="ãƒ’ãƒ³ãƒˆï¼ˆå’Œè¨³ï¼‰">ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼ˆå’Œè¨³ï¼‰</button>
        <button id="giveupBtn" class="secondary" aria-label="ã‚®ãƒ–ã‚¢ãƒƒãƒ—">â¹ ã‚®ãƒ–ã‚¢ãƒƒãƒ—</button>
        <span class="pill"><span class="time" id="time">120</span>s</span>
        <span class="pill">ã‚¹ã‚³ã‚¢ï¼š<span id="score" class="score">0</span></span>
        <span class="pill">æ®‹ã‚Šé•ã„ï¼š<span id="left">5</span></span>
      </div>
    </header>

    <section class="grid">
      <article class="card" aria-live="polite">
        <h2>é•ã†ã¨ã“ã‚’æ¢ã›ï¼ <span class="muted">ï¼ˆå…¨5ç®‡æ‰€ï¼å…ƒã®æœ¬æ–‡ã¯éè¡¨ç¤ºï¼‰</span></h2>
        <p id="modified" class="big" role="group" aria-label="å¤‰æ›´ã•ã‚ŒãŸæœ¬æ–‡"></p>
        <p class="muted">â€» å˜è¤‡ã®ã²ã£ã‹ã‘ã¯ç„¡ã—ã€‚å‰ç½®è©ãƒ»åŠ©å‹•è©ã®åŸå½¢ãƒ»å—ã‘èº«ãƒ»å† è©ãƒ»ç¶´ã‚Šã®åŒºåˆ¥ä¸­å¿ƒã‚„ã§ã€‚</p>
      </article>
    </section>

    <div id="toast" class="toast hidden" role="alert">
      <div id="toastEmoji" style="font-size:20px">ğŸ‰</div>
      <div>
        <strong id="toastTitle">ã‚„ã£ãŸã­ï¼</strong>
        <div id="toastBody">è§£èª¬ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚</div>
      </div>
    </div>

    <div id="modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="modalTitle">
      <div class="scrim"></div>
      <div class="panel">
        <h3 id="modalTitle">ç­”ãˆã¨è§£èª¬</h3>
        <div id="modalBody" class="answers"></div>
        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
          <button id="closeModal" class="flat">é–‰ã˜ã‚‹</button>
        </div>
      </div>
    </div>

    <div id="result" class="result" aria-modal="true" role="dialog" aria-labelledby="resultTitle">
      <div class="scrim"></div>
      <div class="board">
        <div id="resultTitle" class="sub">2åˆ†ãƒãƒ£ãƒ¬ãƒ³ã‚¸ çµæœ</div>
        <div id="resultScore" class="scorebig">0</div>
        <div class="sub">åˆè¨ˆã‚¹ã‚³ã‚¢</div>
        <div style="margin-top:10px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
          <button id="closeResult" class="flat">é–‰ã˜ã‚‹</button>
          <button id="restartBtn">ã‚‚ã†ä¸€å›ï¼</button>
        </div>
      </div>
    </div>

    <p class="footer">ãƒ‡ã‚¶ã‚¤ãƒ³ï¼šãƒãƒƒãƒ—ï¼†å‹‰å¼·ã¯ã‹ã©ã‚‹ã‚„ã¤ã€‚ä½œå•ã¯é«˜æ ¡ç”ŸãŒå¼•ã£ã‹ã‹ã‚Šã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã«å³é¸ã€‚</p>
  </div>

<script>
// ====== å…ƒã®æœ¬æ–‡ï¼ˆè¡¨ç¤ºã¯ã—ãªã„ï¼‰ ======
const SOURCE_TEXT = `What do you see in this picture? A robot is picking tomatoes. With cameras and sensors, it harvests only ripe tomatoes. This is an example of â€œsmart farming.â€ It uses â€œsmartâ€ technology such as robots and ICT. Letâ€™s look at other examples. Some farmers in Chiba monitor their fields with their smartphones. They can collect data and check the condition of their crops from home. On some Hokkaido farms, drones are used to spray fertilizer on the rice fields.`;

// ====== å’Œè¨³ï¼ˆãƒ’ãƒ³ãƒˆè¡¨ç¤ºç”¨ï¼‰ ======
const JP_TEXT = `ã“ã®çµµã§ä½•ãŒè¦‹ãˆã‚‹ï¼Ÿ ãƒ­ãƒœãƒƒãƒˆãŒãƒˆãƒãƒˆã‚’åç©«ã—ã¦ã„ã‚‹ã€‚ ã‚«ãƒ¡ãƒ©ã¨ã‚»ãƒ³ã‚µãƒ¼ã‚’ä½¿ã£ã¦ã€ç†Ÿã—ãŸãƒˆãƒãƒˆã ã‘ã‚’åç©«ã™ã‚‹ã€‚ ã“ã‚Œã¯ã€Œã‚¹ãƒãƒ¼ãƒˆè¾²æ¥­ã€ã®ä¸€ä¾‹ã‚„ã€‚ ãƒ­ãƒœãƒƒãƒˆã‚„ICTãªã©ã®â€œã‚¹ãƒãƒ¼ãƒˆâ€ãªæŠ€è¡“ã‚’ä½¿ã£ã¦ã‚‹ã‚“ã‚„ã€‚ ã»ã‹ã®ä¾‹ã‚‚è¦‹ã¦ã¿ã‚ˆã‹ã€‚ åƒè‘‰ã®ä¸€éƒ¨ã®è¾²å®¶ã¯ã€ã‚¹ãƒãƒ›ã§ç•‘ã‚’è¦‹å®ˆã£ã¦ã‚‹ã€‚ å®¶ã«ã„ãªãŒã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’é›†ã‚ã¦ã€ä½œç‰©ã®çŠ¶æ…‹ã‚’ç¢ºèªã§ãã‚‹ã­ã‚“ã€‚ åŒ—æµ·é“ã®ã„ãã¤ã‹ã®è¾²å ´ã§ã¯ã€ãƒ‰ãƒ­ãƒ¼ãƒ³ã§æ°´ç”°ã«è‚¥æ–™ã‚’æ•£å¸ƒã—ã¦ã‚‹ã§ã€‚`;

function tokenize(text){ return text.split(/\s+/); }
const originalWords = tokenize(SOURCE_TEXT);

// ====== ç½®æ›å€™è£œï¼ˆå˜è¤‡ãƒ»å¯ç®—/ä¸å¯ç®—ã¯é™¤å¤–ï¼‰ ======
const BANK = [
  {target:"in", wrong:"on", reason:"å†™çœŸãƒ»çµµã®ä¸­ã¯ in ã‚’ä½¿ã†ã€‚on this picture ã¯ã€ã“ã®å†™çœŸã®ä¸Šã«ã€ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã€‚"},
  {target:"picking", wrong:"pick", reason:"é€²è¡Œå½¢ã¯ be + V-ingã€‚ã€is pickingã€ãŒæ­£è§£ã‚„ã€‚"},
  {target:"an", wrong:"a", reason:"æ¯éŸ³ã®éŸ³ã®å‰ã¯ anã€‚ã€an exampleã€ãŒæ­£ã—ã„ã€‚"},
  {target:"their", wrong:"there", reason:"theirï¼ˆå½¼ã‚‰ã®ï¼‰ã¨ thereï¼ˆãã“ï¼‰ã¯ç¶´ã‚Šã‚‚æ„å‘³ã‚‚åˆ¥ã‚‚ã‚“ã‚„ã§ã€‚"},
  {target:"collect", wrong:"collects", reason:"can ã®å¾Œã¯å‹•è©ã®åŸå½¢ã€‚ã€can collectã€ã«ã™ã‚‹ã§ã€‚"},
  {target:"check", wrong:"checks", reason:"can ã®å¾Œã¯åŸå½¢ã€‚ã€can checkã€ãŒæ­£è§£ã€‚"},
  {target:"used", wrong:"use", reason:"ã€are used to + å‹•è©ã®åŸå½¢ã€ã®å—ã‘èº«ã€‚use ã«ã™ã‚‹ã¨æ–‡æ³•å´©ã‚Œã‚‹ã€‚"},
  {target:"spray", wrong:"spraying", reason:"ã€be used to + å‹•è©ã®åŸå½¢ã€ãŒã‚»ãƒƒãƒˆã€‚to ã®å¾Œã¯åŸå½¢ã‚„ã€‚"},
  {target:"the", wrong:"a", reason:"ã€the rice fieldsã€ã¯ç‰¹å®šã®ç”°ã‚“ã¼ã€‚a ã«ã™ã‚‹ã¨ã€ã‚ã‚‹ä¸€ã¤ã®ã€ã«ãªã£ã¦ä¸è‡ªç„¶ã€‚"}
];

let timerId = null;
let timeLeft = 120;
let score = 0;
let replacements = []; // {index, from, to, reason}
let found = new Set();
let started = false; // ã‚¹ã‚¿ãƒ¼ãƒˆå‰ã¯å•é¡Œæœªè¡¨ç¤º
let ended = false;   // æ™‚é–“åˆ‡ã‚Œå¾Œã¯æ“ä½œç„¡åŠ¹

const els = {
  modified: document.getElementById('modified'),
  time: document.getElementById('time'),
  score: document.getElementById('score'),
  left: document.getElementById('left'),
  start: document.getElementById('startBtn'),
  newSet: document.getElementById('newSetBtn'),
  hint: document.getElementById('hintBtn'),
  giveup: document.getElementById('giveupBtn'),
  toast: document.getElementById('toast'),
  toastTitle: document.getElementById('toastTitle'),
  toastBody: document.getElementById('toastBody'),
  toastEmoji: document.getElementById('toastEmoji'),
  modal: document.getElementById('modal'),
  modalBody: document.getElementById('modalBody'),
  closeModal: document.getElementById('closeModal'),
  result: document.getElementById('result'),
  resultScore: document.getElementById('resultScore'),
  closeResult: document.getElementById('closeResult'),
  restart: document.getElementById('restartBtn'),
};

function renderModified(){
  els.modified.innerHTML = '';
  const words = buildModified();
  words.forEach((w, i)=>{
    const span = document.createElement('span');
    span.className = 'word';
    span.textContent = w + (i < words.length-1 ? ' ' : '');
    span.dataset.index = i;
    span.addEventListener('click', onWordClick);
    els.modified.appendChild(span);
  });
}

function sampleFive(){
  const valid = BANK.filter(b => originalWords.includes(b.target));
  for(let i=valid.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [valid[i],valid[j]]=[valid[j],valid[i]]; }
  const picks = valid.slice(0,5);
  const taken = new Set();
  replacements = picks.map(b => {
    let idx = originalWords.findIndex((w, i)=> w===b.target && !taken.has(i));
    if(idx===-1){ idx = originalWords.indexOf(b.target); }
    taken.add(idx);
    return { index: idx, from: b.target, to: b.wrong, reason: b.reason };
  });
}

function buildModified(){
  const words = [...originalWords];
  for(const r of replacements){ words[r.index] = r.to; }
  return words;
}

function updateStats(){
  els.score.textContent = score;
  els.score.className = 'score' + (score < 0 ? ' neg' : '');
  const left = 5 - found.size;
  els.left.textContent = left;
}

function toast(title, body, good=true){
  els.toastTitle.textContent = title;
  els.toastBody.textContent = body;
  els.toastEmoji.textContent = good ? 'âœ¨' : 'ğŸ§';
  els.toast.classList.remove('hidden');
  clearTimeout(els.toast._t);
  els.toast._t = setTimeout(()=> els.toast.classList.add('hidden'), 2600);
}

function hintFromRemaining(){
  const remaining = replacements.filter(r=> !found.has(r.index));
  if(remaining.length===0) return 'å…¨éƒ¨ã‚¯ãƒªã‚¢ï¼ä½œã‚Šç›´ã—ã§æ¬¡ã„ã“ï¼';
  const r = remaining[Math.floor(Math.random()*remaining.length)];
  return `ãƒ’ãƒ³ãƒˆï¼š${r.reason}`;
}

function showAnswers(){
  if(!started || replacements.length===0){
    toast('ã¾ã å§‹ã¾ã£ã¦ãªã„ã§','ã‚¹ã‚¿ãƒ¼ãƒˆâ†’è§£ãâ†’ã‚®ãƒ–ã‚¢ãƒƒãƒ—ã§ç­”ãˆè¡¨ç¤ºã‚„ã§ã€‚', false);
    return;
  }
  let html = '<ol>';
  for(const r of replacements){
    const isFound = found.has(r.index);
    html += `<li>${isFound ? 'âœ…' : 'âŒ'} ã€Œ${r.from} â†’ ${r.to}ã€ã¯èª¤ã‚Šã€‚æ­£ã—ãã¯ã€${r.from}ã€ã‚„ã§ã€‚ç†ç”±ï¼š${r.reason}</li>`;
  }
  html += '</ol>';
  els.modalBody.innerHTML = html;
  els.modal.classList.add('show');
}

function onWordClick(e){
  if(!started || ended) { return; }
  if(timeLeft<=0) return;
  const idx = Number(e.currentTarget.dataset.index);
  const r = replacements.find(x=>x.index===idx);
  e.currentTarget.classList.add('clicked');
  if(r && !found.has(idx)){
    found.add(idx);
    e.currentTarget.classList.add('correct');
    score += 1;
    toast('æ­£è§£ï¼+1', `ã€Œ${r.from} â†’ ${r.to}ã€ã¯é–“é•ã„ã€‚ç†ç”±ï¼š${r.reason}`, true);
  }else{
    e.currentTarget.classList.add('wrong');
    score -= 1;
    toast('æƒœã—ã„ âˆ’1', hintFromRemaining(), false);
  }
  updateStats();
  if(found.size===5){
    // ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¯ãƒªã‚¢ï¼šã‚¿ã‚¤ãƒãƒ¼ã¯æ­¢ã‚ãšã€æ¬¡ã®å•é¡Œã¸
    toast('ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼', 'ä½œã‚Šç›´ã—ã›ã‚“ã§ã‚‚æ¬¡ã®ã‚»ãƒƒãƒˆã«å…¥ã£ãŸã§ï¼', true);
    nextRound();
  }
}

function nextRound(){
  found.clear();
  updateStats();
  sampleFive();
  renderModified();
}

function tick(){
  timeLeft -= 1;
  els.time.textContent = timeLeft;
  if(timeLeft<=0){ timeUp(); }
}

function start(){
  clearInterval(timerId);
  timeLeft = 120; score = 0; found.clear(); ended = false; started = true;
  els.time.textContent = timeLeft; updateStats();
  sampleFive(); renderModified();
  timerId = setInterval(tick, 1000);
  els.toast.classList.add('hidden');
}

function newSet(){
  if(!started || ended){ toast('ã¾ãšã¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼','å…ˆã«ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãªã€‚'); return; }
  nextRound();
  toast('æ–°ã—ã„å•é¡Œï¼', '5ç®‡æ‰€å…¥ã‚Œæ›¿ãˆãŸã§ã€‚ç¶šè¡Œã‚„ï¼');
}

function timeUp(){
  ended = true;
  clearInterval(timerId);
  els.resultScore.textContent = String(score);
  document.getElementById('result').style.display = 'flex';
}

// ãƒœã‚¿ãƒ³
els.start.addEventListener('click', start);
els.newSet.addEventListener('click', newSet);
els.hint.addEventListener('click', ()=>{ toast('å’Œè¨³ãƒ’ãƒ³ãƒˆ', JP_TEXT, true); });
els.giveup.addEventListener('click', ()=>{ showAnswers(); });
els.closeModal.addEventListener('click', ()=> els.modal.classList.remove('show'));
document.querySelector('#modal .scrim').addEventListener('click', ()=> els.modal.classList.remove('show'));
els.closeResult.addEventListener('click', ()=> document.getElementById('result').style.display = 'none');
els.restart.addEventListener('click', ()=>{ document.getElementById('result').style.display = 'none'; start(); });

// åˆæœŸè¡¨ç¤ºï¼šå•é¡Œã¯å‡ºã•ãªã„ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆã¾ã§ç©ºï¼‰
updateStats();
setTimeout(()=> toast('æº–å‚™OKï¼Ÿ', 'ã‚¹ã‚¿ãƒ¼ãƒˆã§2åˆ†ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹ã€‚ä½œã‚Šç›´ã—ã›ãšã«5å•è¦‹ã¤ã‘ãŸã‚‰è‡ªå‹•ã§æ¬¡ã‚»ãƒƒãƒˆã‚„ã§ï¼'), 500);
</script>
</body>
</html>
